FROM langgenius/dify-api:0.13.1

# Use the shared environment variables.
ENV WORKFLOW_FILE_UPLOAD_LIMIT=${WORKFLOW_FILE_UPLOAD_LIMIT:-10}
ENV LOG_LEVEL=${LOG_LEVEL:-INFO}
ENV LOG_FILE=${LOG_FILE:-}
ENV LOG_FILE_MAX_SIZE=${LOG_FILE_MAX_SIZE:-20}
ENV LOG_FILE_BACKUP_COUNT=${LOG_FILE_BACKUP_COUNT:-5}
# Log dateformat
ENV LOG_DATEFORMAT=${LOG_DATEFORMAT:-%Y-%m-%d\ %H:%M:%S}
# Log Timezone
ENV LOG_TZ=${LOG_TZ:-UTC}
ENV DEBUG=${DEBUG:-false}
ENV FLASK_DEBUG=${FLASK_DEBUG:-false}
ENV SECRET_KEY=${SECRET_KEY:-sk-9f73s3ljTXVcMT3Blb3ljTqtsKiGHXVcMT3BlbkFJLK7U}
ENV INIT_PASSWORD=${INIT_PASSWORD:-}
ENV CONSOLE_WEB_URL=${CONSOLE_WEB_URL:-}
ENV CONSOLE_API_URL=${CONSOLE_API_URL:-}
ENV SERVICE_API_URL=${SERVICE_API_URL:-}
ENV APP_WEB_URL=${APP_WEB_URL:-}
ENV CHECK_UPDATE_URL=${CHECK_UPDATE_URL:-https://updates.dify.ai}
ENV OPENAI_API_BASE=${OPENAI_API_BASE:-https://api.openai.com/v1}
ENV FILES_URL=${FILES_URL:-}
ENV FILES_ACCESS_TIMEOUT=${FILES_ACCESS_TIMEOUT:-300}
ENV APP_MAX_ACTIVE_REQUESTS=${APP_MAX_ACTIVE_REQUESTS:-0}
ENV MIGRATION_ENABLED=${MIGRATION_ENABLED:-true}
ENV DEPLOY_ENV=${DEPLOY_ENV:-PRODUCTION}
ENV DIFY_BIND_ADDRESS=${DIFY_BIND_ADDRESS:-0.0.0.0}
ENV DIFY_PORT=${DIFY_PORT:-5001}
ENV SERVER_WORKER_AMOUNT=${SERVER_WORKER_AMOUNT:-}
ENV SERVER_WORKER_CLASS=${SERVER_WORKER_CLASS:-}
ENV CELERY_WORKER_CLASS=${CELERY_WORKER_CLASS:-}
ENV GUNICORN_TIMEOUT=${GUNICORN_TIMEOUT:-360}
ENV CELERY_WORKER_AMOUNT=${CELERY_WORKER_AMOUNT:-}
ENV CELERY_AUTO_SCALE=${CELERY_AUTO_SCALE:-false}
ENV CELERY_MAX_WORKERS=${CELERY_MAX_WORKERS:-}
ENV CELERY_MIN_WORKERS=${CELERY_MIN_WORKERS:-}
ENV API_TOOL_DEFAULT_CONNECT_TIMEOUT=${API_TOOL_DEFAULT_CONNECT_TIMEOUT:-10}
ENV API_TOOL_DEFAULT_READ_TIMEOUT=${API_TOOL_DEFAULT_READ_TIMEOUT:-60}
ENV DB_USERNAME=${DB_USERNAME:-utk}
ENV DB_PASSWORD=${DB_PASSWORD:-utkpass}
ENV DB_HOST=${DB_HOST:-pg_local}
ENV DB_PORT=${DB_PORT:-5432}
ENV DB_DATABASE=${DB_DATABASE:-dify}
ENV SQLALCHEMY_POOL_SIZE=${SQLALCHEMY_POOL_SIZE:-30}
ENV SQLALCHEMY_POOL_RECYCLE=${SQLALCHEMY_POOL_RECYCLE:-3600}
ENV SQLALCHEMY_ECHO=${SQLALCHEMY_ECHO:-false}
ENV REDIS_HOST=${REDIS_HOST:-redis_local}
ENV REDIS_PORT=${REDIS_PORT:-6379}
ENV REDIS_USERNAME=${REDIS_USERNAME:-}
ENV REDIS_PASSWORD=${REDIS_PASSWORD:-}
ENV REDIS_USE_SSL=${REDIS_USE_SSL:-false}
ENV REDIS_DB=${REDIS_DB:-0}
ENV REDIS_USE_SENTINEL=${REDIS_USE_SENTINEL:-false}
ENV REDIS_SENTINELS=${REDIS_SENTINELS:-}
ENV REDIS_SENTINEL_SERVICE_NAME=${REDIS_SENTINEL_SERVICE_NAME:-}
ENV REDIS_SENTINEL_USERNAME=${REDIS_SENTINEL_USERNAME:-}
ENV REDIS_SENTINEL_PASSWORD=${REDIS_SENTINEL_PASSWORD:-}
ENV REDIS_SENTINEL_SOCKET_TIMEOUT=${REDIS_SENTINEL_SOCKET_TIMEOUT:-0.1}
ENV REDIS_CLUSTERS=${REDIS_CLUSTERS:-}
ENV REDIS_USE_CLUSTERS=${REDIS_USE_CLUSTERS:-false}
ENV REDIS_CLUSTERS_PASSWORD=${REDIS_CLUSTERS_PASSWORD:-}
ENV ACCESS_TOKEN_EXPIRE_MINUTES=${ACCESS_TOKEN_EXPIRE_MINUTES:-60}
ENV CELERY_BROKER_URL=${CELERY_BROKER_URL:-redis://:difyai123456@redis:6379/1}
ENV BROKER_USE_SSL=${BROKER_USE_SSL:-false}
ENV CELERY_USE_SENTINEL=${CELERY_USE_SENTINEL:-false}
ENV CELERY_SENTINEL_MASTER_NAME=${CELERY_SENTINEL_MASTER_NAME:-}
ENV CELERY_SENTINEL_SOCKET_TIMEOUT=${CELERY_SENTINEL_SOCKET_TIMEOUT:-0.1}
ENV WEB_API_CORS_ALLOW_ORIGINS=${WEB_API_CORS_ALLOW_ORIGINS:-*}
ENV CONSOLE_CORS_ALLOW_ORIGINS=${CONSOLE_CORS_ALLOW_ORIGINS:-*}
ENV STORAGE_TYPE=${STORAGE_TYPE:-local}
ENV STORAGE_LOCAL_PATH=${STORAGE_LOCAL_PATH:-storage}
ENV S3_USE_AWS_MANAGED_IAM=${S3_USE_AWS_MANAGED_IAM:-false}
ENV S3_ENDPOINT=${S3_ENDPOINT:-}
ENV S3_BUCKET_NAME=${S3_BUCKET_NAME:-}
ENV S3_ACCESS_KEY=${S3_ACCESS_KEY:-}
ENV S3_SECRET_KEY=${S3_SECRET_KEY:-}
ENV S3_REGION=${S3_REGION:-us-east-1}
ENV AZURE_BLOB_ACCOUNT_NAME=${AZURE_BLOB_ACCOUNT_NAME:-}
ENV AZURE_BLOB_ACCOUNT_KEY=${AZURE_BLOB_ACCOUNT_KEY:-}
ENV AZURE_BLOB_CONTAINER_NAME=${AZURE_BLOB_CONTAINER_NAME:-}
ENV AZURE_BLOB_ACCOUNT_URL=${AZURE_BLOB_ACCOUNT_URL:-}
ENV GOOGLE_STORAGE_BUCKET_NAME=${GOOGLE_STORAGE_BUCKET_NAME:-}
ENV GOOGLE_STORAGE_SERVICE_ACCOUNT_JSON_BASE64=${GOOGLE_STORAGE_SERVICE_ACCOUNT_JSON_BASE64:-}
ENV ALIYUN_OSS_BUCKET_NAME=${ALIYUN_OSS_BUCKET_NAME:-}
ENV ALIYUN_OSS_ACCESS_KEY=${ALIYUN_OSS_ACCESS_KEY:-}
ENV ALIYUN_OSS_SECRET_KEY=${ALIYUN_OSS_SECRET_KEY:-}
ENV ALIYUN_OSS_ENDPOINT=${ALIYUN_OSS_ENDPOINT:-}
ENV ALIYUN_OSS_REGION=${ALIYUN_OSS_REGION:-}
ENV ALIYUN_OSS_AUTH_VERSION=${ALIYUN_OSS_AUTH_VERSION:-v4}
ENV ALIYUN_OSS_PATH=${ALIYUN_OSS_PATH:-}
ENV TENCENT_COS_BUCKET_NAME=${TENCENT_COS_BUCKET_NAME:-}
ENV TENCENT_COS_SECRET_KEY=${TENCENT_COS_SECRET_KEY:-}
ENV TENCENT_COS_SECRET_ID=${TENCENT_COS_SECRET_ID:-}
ENV TENCENT_COS_REGION=${TENCENT_COS_REGION:-}
ENV TENCENT_COS_SCHEME=${TENCENT_COS_SCHEME:-}
ENV HUAWEI_OBS_BUCKET_NAME=${HUAWEI_OBS_BUCKET_NAME:-}
ENV HUAWEI_OBS_SECRET_KEY=${HUAWEI_OBS_SECRET_KEY:-}
ENV HUAWEI_OBS_ACCESS_KEY=${HUAWEI_OBS_ACCESS_KEY:-}
ENV HUAWEI_OBS_SERVER=${HUAWEI_OBS_SERVER:-}
ENV OCI_ENDPOINT=${OCI_ENDPOINT:-}
ENV OCI_BUCKET_NAME=${OCI_BUCKET_NAME:-}
ENV OCI_ACCESS_KEY=${OCI_ACCESS_KEY:-}
ENV OCI_SECRET_KEY=${OCI_SECRET_KEY:-}
ENV OCI_REGION=${OCI_REGION:-}
ENV VOLCENGINE_TOS_BUCKET_NAME=${VOLCENGINE_TOS_BUCKET_NAME:-}
ENV VOLCENGINE_TOS_SECRET_KEY=${VOLCENGINE_TOS_SECRET_KEY:-}
ENV VOLCENGINE_TOS_ACCESS_KEY=${VOLCENGINE_TOS_ACCESS_KEY:-}
ENV VOLCENGINE_TOS_ENDPOINT=${VOLCENGINE_TOS_ENDPOINT:-}
ENV VOLCENGINE_TOS_REGION=${VOLCENGINE_TOS_REGION:-}
ENV BAIDU_OBS_BUCKET_NAME=${BAIDU_OBS_BUCKET_NAME:-}
ENV BAIDU_OBS_SECRET_KEY=${BAIDU_OBS_SECRET_KEY:-}
ENV BAIDU_OBS_ACCESS_KEY=${BAIDU_OBS_ACCESS_KEY:-}
ENV BAIDU_OBS_ENDPOINT=${BAIDU_OBS_ENDPOINT:-}
ENV VECTOR_STORE=${VECTOR_STORE:-weaviate}
ENV WEAVIATE_ENDPOINT=${WEAVIATE_ENDPOINT:-http://weaviate:8080}
ENV WEAVIATE_API_KEY=${WEAVIATE_API_KEY:-WVF5YThaHlkYwhGUSmCRgsX3tD5ngdN8pkih}
ENV QDRANT_URL=${QDRANT_URL:-http://qdrant:6333}
ENV QDRANT_API_KEY=${QDRANT_API_KEY:-difyai123456}
ENV QDRANT_CLIENT_TIMEOUT=${QDRANT_CLIENT_TIMEOUT:-20}
ENV QDRANT_GRPC_ENABLED=${QDRANT_GRPC_ENABLED:-false}
ENV QDRANT_GRPC_PORT=${QDRANT_GRPC_PORT:-6334}
ENV COUCHBASE_CONNECTION_STRING=${COUCHBASE_CONNECTION_STRING:-'couchbase-server'}
ENV COUCHBASE_USER=${COUCHBASE_USER:-Administrator}
ENV COUCHBASE_PASSWORD=${COUCHBASE_PASSWORD:-password}
ENV COUCHBASE_BUCKET_NAME=${COUCHBASE_BUCKET_NAME:-Embeddings}
ENV COUCHBASE_SCOPE_NAME=${COUCHBASE_SCOPE_NAME:-_default}
ENV MILVUS_URI=${MILVUS_URI:-http://127.0.0.1:19530}
ENV MILVUS_TOKEN=${MILVUS_TOKEN:-}
ENV MILVUS_USER=${MILVUS_USER:-root}
ENV MILVUS_PASSWORD=${MILVUS_PASSWORD:-Milvus}
ENV MYSCALE_HOST=${MYSCALE_HOST:-myscale}
ENV MYSCALE_PORT=${MYSCALE_PORT:-8123}
ENV MYSCALE_USER=${MYSCALE_USER:-default}
ENV MYSCALE_PASSWORD=${MYSCALE_PASSWORD:-}
ENV MYSCALE_DATABASE=${MYSCALE_DATABASE:-dify}
ENV MYSCALE_FTS_PARAMS=${MYSCALE_FTS_PARAMS:-}
ENV RELYT_HOST=${RELYT_HOST:-db}
ENV RELYT_PORT=${RELYT_PORT:-5432}
ENV RELYT_USER=${RELYT_USER:-postgres}
ENV RELYT_PASSWORD=${RELYT_PASSWORD:-difyai123456}
ENV RELYT_DATABASE=${RELYT_DATABASE:-postgres}
ENV PGVECTOR_HOST=${PGVECTOR_HOST:-pgvector}
ENV PGVECTOR_PORT=${PGVECTOR_PORT:-5432}
ENV PGVECTOR_USER=${PGVECTOR_USER:-postgres}
ENV PGVECTOR_PASSWORD=${PGVECTOR_PASSWORD:-difyai123456}
ENV PGVECTOR_DATABASE=${PGVECTOR_DATABASE:-dify}
ENV TIDB_VECTOR_HOST=${TIDB_VECTOR_HOST:-tidb}
ENV TIDB_VECTOR_PORT=${TIDB_VECTOR_PORT:-4000}
ENV TIDB_VECTOR_USER=${TIDB_VECTOR_USER:-}
ENV TIDB_VECTOR_PASSWORD=${TIDB_VECTOR_PASSWORD:-}
ENV TIDB_VECTOR_DATABASE=${TIDB_VECTOR_DATABASE:-dify}
ENV TIDB_ON_QDRANT_URL=${TIDB_ON_QDRANT_URL:-http://127.0.0.1}
ENV TIDB_ON_QDRANT_API_KEY=${TIDB_ON_QDRANT_API_KEY:-dify}
ENV TIDB_ON_QDRANT_CLIENT_TIMEOUT=${TIDB_ON_QDRANT_CLIENT_TIMEOUT:-20}
ENV TIDB_ON_QDRANT_GRPC_ENABLED=${TIDB_ON_QDRANT_GRPC_ENABLED:-false}
ENV TIDB_ON_QDRANT_GRPC_PORT=${TIDB_ON_QDRANT_GRPC_PORT:-6334}
ENV TIDB_PUBLIC_KEY=${TIDB_PUBLIC_KEY:-dify}
ENV TIDB_PRIVATE_KEY=${TIDB_PRIVATE_KEY:-dify}
ENV TIDB_API_URL=${TIDB_API_URL:-http://127.0.0.1}
ENV TIDB_IAM_API_URL=${TIDB_IAM_API_URL:-http://127.0.0.1}
ENV TIDB_REGION=${TIDB_REGION:-regions/aws-us-east-1}
ENV TIDB_PROJECT_ID=${TIDB_PROJECT_ID:-dify}
ENV TIDB_SPEND_LIMIT=${TIDB_SPEND_LIMIT:-100}
ENV ORACLE_HOST=${ORACLE_HOST:-oracle}
ENV ORACLE_PORT=${ORACLE_PORT:-1521}
ENV ORACLE_USER=${ORACLE_USER:-dify}
ENV ORACLE_PASSWORD=${ORACLE_PASSWORD:-dify}
ENV ORACLE_DATABASE=${ORACLE_DATABASE:-FREEPDB1}
ENV CHROMA_HOST=${CHROMA_HOST:-127.0.0.1}
ENV CHROMA_PORT=${CHROMA_PORT:-8000}
ENV CHROMA_TENANT=${CHROMA_TENANT:-default_tenant}
ENV CHROMA_DATABASE=${CHROMA_DATABASE:-default_database}
ENV CHROMA_AUTH_PROVIDER=${CHROMA_AUTH_PROVIDER:-chromadb.auth.token_authn.TokenAuthClientProvider}
ENV CHROMA_AUTH_CREDENTIALS=${CHROMA_AUTH_CREDENTIALS:-}
ENV ELASTICSEARCH_HOST=${ELASTICSEARCH_HOST:-0.0.0.0}
ENV ELASTICSEARCH_PORT=${ELASTICSEARCH_PORT:-9200}
ENV ELASTICSEARCH_USERNAME=${ELASTICSEARCH_USERNAME:-elastic}
ENV ELASTICSEARCH_PASSWORD=${ELASTICSEARCH_PASSWORD:-elastic}
ENV LINDORM_URL=${LINDORM_URL:-http://lindorm:30070}
ENV LINDORM_USERNAME=${LINDORM_USERNAME:-lindorm}
ENV LINDORM_PASSWORD=${LINDORM_PASSWORD:-lindorm}
ENV KIBANA_PORT=${KIBANA_PORT:-5601}
# AnalyticDB configuration
ENV ANALYTICDB_KEY_ID=${ANALYTICDB_KEY_ID:-}
ENV ANALYTICDB_KEY_SECRET=${ANALYTICDB_KEY_SECRET:-}
ENV ANALYTICDB_REGION_ID=${ANALYTICDB_REGION_ID:-}
ENV ANALYTICDB_INSTANCE_ID=${ANALYTICDB_INSTANCE_ID:-}
ENV ANALYTICDB_ACCOUNT=${ANALYTICDB_ACCOUNT:-}
ENV ANALYTICDB_PASSWORD=${ANALYTICDB_PASSWORD:-}
ENV ANALYTICDB_NAMESPACE=${ANALYTICDB_NAMESPACE:-dify}
ENV ANALYTICDB_NAMESPACE_PASSWORD=${ANALYTICDB_NAMESPACE_PASSWORD:-}
ENV ANALYTICDB_HOST=${ANALYTICDB_HOST:-}
ENV ANALYTICDB_PORT=${ANALYTICDB_PORT:-5432}
ENV ANALYTICDB_MIN_CONNECTION=${ANALYTICDB_MIN_CONNECTION:-1}
ENV ANALYTICDB_MAX_CONNECTION=${ANALYTICDB_MAX_CONNECTION:-5}
ENV OPENSEARCH_HOST=${OPENSEARCH_HOST:-opensearch}
ENV OPENSEARCH_PORT=${OPENSEARCH_PORT:-9200}
ENV OPENSEARCH_USER=${OPENSEARCH_USER:-admin}
ENV OPENSEARCH_PASSWORD=${OPENSEARCH_PASSWORD:-admin}
ENV OPENSEARCH_SECURE=${OPENSEARCH_SECURE:-true}
ENV TENCENT_VECTOR_DB_URL=${TENCENT_VECTOR_DB_URL:-http://127.0.0.1}
ENV TENCENT_VECTOR_DB_API_KEY=${TENCENT_VECTOR_DB_API_KEY:-dify}
ENV TENCENT_VECTOR_DB_TIMEOUT=${TENCENT_VECTOR_DB_TIMEOUT:-30}
ENV TENCENT_VECTOR_DB_USERNAME=${TENCENT_VECTOR_DB_USERNAME:-dify}
ENV TENCENT_VECTOR_DB_DATABASE=${TENCENT_VECTOR_DB_DATABASE:-dify}
ENV TENCENT_VECTOR_DB_SHARD=${TENCENT_VECTOR_DB_SHARD:-1}
ENV TENCENT_VECTOR_DB_REPLICAS=${TENCENT_VECTOR_DB_REPLICAS:-2}
ENV BAIDU_VECTOR_DB_ENDPOINT=${BAIDU_VECTOR_DB_ENDPOINT:-http://127.0.0.1:5287}
ENV BAIDU_VECTOR_DB_CONNECTION_TIMEOUT_MS=${BAIDU_VECTOR_DB_CONNECTION_TIMEOUT_MS:-30000}
ENV BAIDU_VECTOR_DB_ACCOUNT=${BAIDU_VECTOR_DB_ACCOUNT:-root}
ENV BAIDU_VECTOR_DB_API_KEY=${BAIDU_VECTOR_DB_API_KEY:-dify}
ENV BAIDU_VECTOR_DB_DATABASE=${BAIDU_VECTOR_DB_DATABASE:-dify}
ENV BAIDU_VECTOR_DB_SHARD=${BAIDU_VECTOR_DB_SHARD:-1}
ENV BAIDU_VECTOR_DB_REPLICAS=${BAIDU_VECTOR_DB_REPLICAS:-3}
ENV VIKINGDB_ACCESS_KEY=${VIKINGDB_ACCESS_KEY:-dify}
ENV VIKINGDB_SECRET_KEY=${VIKINGDB_SECRET_KEY:-dify}
ENV VIKINGDB_REGION=${VIKINGDB_REGION:-cn-shanghai}
ENV VIKINGDB_HOST=${VIKINGDB_HOST:-api-vikingdb.xxx.volces.com}
ENV VIKINGDB_SCHEMA=${VIKINGDB_SCHEMA:-http}
ENV UPSTASH_VECTOR_URL=${UPSTASH_VECTOR_URL:-https://xxx-vector.upstash.io}
ENV UPSTASH_VECTOR_TOKEN=${UPSTASH_VECTOR_TOKEN:-dify}
ENV UPLOAD_FILE_SIZE_LIMIT=${UPLOAD_FILE_SIZE_LIMIT:-15}
ENV UPLOAD_FILE_BATCH_LIMIT=${UPLOAD_FILE_BATCH_LIMIT:-5}
ENV ETL_TYPE=${ETL_TYPE:-dify}
ENV UNSTRUCTURED_API_URL=${UNSTRUCTURED_API_URL:-}
ENV UNSTRUCTURED_API_KEY=${UNSTRUCTURED_API_KEY:-}
ENV PROMPT_GENERATION_MAX_TOKENS=${PROMPT_GENERATION_MAX_TOKENS:-512}
ENV CODE_GENERATION_MAX_TOKENS=${CODE_GENERATION_MAX_TOKENS:-1024}
ENV MULTIMODAL_SEND_IMAGE_FORMAT=${MULTIMODAL_SEND_IMAGE_FORMAT:-base64}
ENV MULTIMODAL_SEND_VIDEO_FORMAT=${MULTIMODAL_SEND_VIDEO_FORMAT:-base64}
ENV UPLOAD_IMAGE_FILE_SIZE_LIMIT=${UPLOAD_IMAGE_FILE_SIZE_LIMIT:-10}
ENV UPLOAD_VIDEO_FILE_SIZE_LIMIT=${UPLOAD_VIDEO_FILE_SIZE_LIMIT:-100}
ENV UPLOAD_AUDIO_FILE_SIZE_LIMIT=${UPLOAD_AUDIO_FILE_SIZE_LIMIT:-50}
ENV SENTRY_DSN=${API_SENTRY_DSN:-}
ENV SENTRY_TRACES_SAMPLE_RATE=${API_SENTRY_TRACES_SAMPLE_RATE:-1.0}
ENV SENTRY_PROFILES_SAMPLE_RATE=${API_SENTRY_PROFILES_SAMPLE_RATE:-1.0}
ENV NOTION_INTEGRATION_TYPE=${NOTION_INTEGRATION_TYPE:-public}
ENV NOTION_CLIENT_SECRET=${NOTION_CLIENT_SECRET:-}
ENV NOTION_CLIENT_ID=${NOTION_CLIENT_ID:-}
ENV NOTION_INTERNAL_SECRET=${NOTION_INTERNAL_SECRET:-}
ENV MAIL_TYPE=${MAIL_TYPE:-resend}
ENV MAIL_DEFAULT_SEND_FROM=${MAIL_DEFAULT_SEND_FROM:-}
ENV SMTP_SERVER=${SMTP_SERVER:-}
ENV SMTP_PORT=${SMTP_PORT:-465}
ENV SMTP_USERNAME=${SMTP_USERNAME:-}
ENV SMTP_PASSWORD=${SMTP_PASSWORD:-}
ENV SMTP_USE_TLS=${SMTP_USE_TLS:-true}
ENV SMTP_OPPORTUNISTIC_TLS=${SMTP_OPPORTUNISTIC_TLS:-false}
ENV RESEND_API_KEY=${RESEND_API_KEY:-your-resend-api-key}
ENV RESEND_API_URL=${RESEND_API_URL:-https://api.resend.com}
ENV INDEXING_MAX_SEGMENTATION_TOKENS_LENGTH=${INDEXING_MAX_SEGMENTATION_TOKENS_LENGTH:-4000}
ENV INVITE_EXPIRY_HOURS=${INVITE_EXPIRY_HOURS:-72}
ENV RESET_PASSWORD_TOKEN_EXPIRY_MINUTES=${RESET_PASSWORD_TOKEN_EXPIRY_MINUTES:-5}
ENV CODE_EXECUTION_ENDPOINT=${CODE_EXECUTION_ENDPOINT:-http://sandbox:8194}
ENV CODE_EXECUTION_API_KEY=${SANDBOX_API_KEY:-dify-sandbox}
ENV CODE_EXECUTION_CONNECT_TIMEOUT=${CODE_EXECUTION_CONNECT_TIMEOUT:-10}
ENV CODE_EXECUTION_READ_TIMEOUT=${CODE_EXECUTION_READ_TIMEOUT:-60}
ENV CODE_EXECUTION_WRITE_TIMEOUT=${CODE_EXECUTION_WRITE_TIMEOUT:-10}
ENV CODE_MAX_NUMBER=${CODE_MAX_NUMBER:-9223372036854775807}
ENV CODE_MIN_NUMBER=${CODE_MIN_NUMBER:--9223372036854775808}
ENV CODE_MAX_DEPTH=${CODE_MAX_DEPTH:-5}
ENV CODE_MAX_PRECISION=${CODE_MAX_PRECISION:-20}
ENV CODE_MAX_STRING_LENGTH=${CODE_MAX_STRING_LENGTH:-80000}
ENV TEMPLATE_TRANSFORM_MAX_LENGTH=${TEMPLATE_TRANSFORM_MAX_LENGTH:-80000}
ENV CODE_MAX_STRING_ARRAY_LENGTH=${CODE_MAX_STRING_ARRAY_LENGTH:-30}
ENV CODE_MAX_OBJECT_ARRAY_LENGTH=${CODE_MAX_OBJECT_ARRAY_LENGTH:-30}
ENV CODE_MAX_NUMBER_ARRAY_LENGTH=${CODE_MAX_NUMBER_ARRAY_LENGTH:-1000}
ENV WORKFLOW_MAX_EXECUTION_STEPS=${WORKFLOW_MAX_EXECUTION_STEPS:-500}
ENV WORKFLOW_MAX_EXECUTION_TIME=${WORKFLOW_MAX_EXECUTION_TIME:-1200}
ENV WORKFLOW_CALL_MAX_DEPTH=${WORKFLOW_CALL_MAX_DEPTH:-5}
ENV SSRF_PROXY_HTTP_URL=${SSRF_PROXY_HTTP_URL:-http://ssrf_proxy:3128}
ENV SSRF_PROXY_HTTPS_URL=${SSRF_PROXY_HTTPS_URL:-http://ssrf_proxy:3128}
ENV HTTP_REQUEST_NODE_MAX_BINARY_SIZE=${HTTP_REQUEST_NODE_MAX_BINARY_SIZE:-10485760}
ENV HTTP_REQUEST_NODE_MAX_TEXT_SIZE=${HTTP_REQUEST_NODE_MAX_TEXT_SIZE:-1048576}
ENV APP_MAX_EXECUTION_TIME=${APP_MAX_EXECUTION_TIME:-12000}
ENV POSITION_TOOL_PINS=${POSITION_TOOL_PINS:-}
ENV POSITION_TOOL_INCLUDES=${POSITION_TOOL_INCLUDES:-}
ENV POSITION_TOOL_EXCLUDES=${POSITION_TOOL_EXCLUDES:-}
ENV POSITION_PROVIDER_PINS=${POSITION_PROVIDER_PINS:-}
ENV POSITION_PROVIDER_INCLUDES=${POSITION_PROVIDER_INCLUDES:-}
ENV POSITION_PROVIDER_EXCLUDES=${POSITION_PROVIDER_EXCLUDES:-}
ENV MAX_VARIABLE_SIZE=${MAX_VARIABLE_SIZE:-204800}
ENV OCEANBASE_VECTOR_HOST=${OCEANBASE_VECTOR_HOST:-http://oceanbase-vector}
ENV OCEANBASE_VECTOR_PORT=${OCEANBASE_VECTOR_PORT:-2881}
ENV OCEANBASE_VECTOR_USER=${OCEANBASE_VECTOR_USER:-root@test}
ENV OCEANBASE_VECTOR_PASSWORD=${OCEANBASE_VECTOR_PASSWORD:-difyai123456}
ENV OCEANBASE_VECTOR_DATABASE=${OCEANBASE_VECTOR_DATABASE:-test}
ENV OCEANBASE_CLUSTER_NAME=${OCEANBASE_CLUSTER_NAME:-difyai}
ENV OCEANBASE_MEMORY_LIMIT=${OCEANBASE_MEMORY_LIMIT:-6G}
ENV CREATE_TIDB_SERVICE_JOB_ENABLED=${CREATE_TIDB_SERVICE_JOB_ENABLED:-false}
ENV RETRIEVAL_TOP_N=${RETRIEVAL_TOP_N:-0}
# Startup mode, 'worker' starts the Celery worker for processing the queue.
ENV MODE=api
ENV LOG_LEVEL=INFO
ENV DEPLOY_ENV=PRODUCTION
ENV MIGRATION_ENABLED=false
ENV SERVER_WORKER_AMOUNT=
ENV SERVER_WORKER_CLASS=
ENV DB_HOST=host.docker.internal
ENV REDIS_HOST=host.docker.internal
ENV CELERY_WORKER_CLASS=gevent
ENV CELERY_WORKER_AMOUNT=1
ENV CELERY_BROKER_URL=redis://redis:6379/1
ENV WEAVIATE_ENDPOINT=http://weaviate:8080
ENV APP_WEB_URL=http://localhost
ENV CONSOLE_API_URL=http://localhost
ENV CONSOLE_WEB_URL=http://localhost
ENV SERVICE_API_URL=http://localhost
ENV SSRF_PROXY_HTTP_URL=http://ssrf-proxy:3128
ENV SSRF_PROXY_HTTPS_URL=http://ssrf-proxy:3128
ENV SSRF_DEFAULT_MAX_RETRIES=3
ENV SSRF_DEFAULT_TIME_OUT=15
ENV SSRF_DEFAULT_CONNECT_TIME_OUT=5
ENV SSRF_DEFAULT_READ_TIME_OUT=5
ENV SSRF_DEFAULT_WRITE_TIME_OUT=5

# Copy the storage directory to the container, for storing user files.
COPY ./docker/volumes/app/storage /app/api/storage

VOLUME /app/api/storage

EXPOSE 5001